<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="attr.js" defer type="module"></script>
    <title>Attr JS</title>
  </head>
  <body>
    <div class="container">
      <div
        x-data="{draft:'', buffer:'', edit: true}"
        history="true"
        history-limit="100"
      >
        <!-- editing -->
        <div x-show="edit">
          <div class="wrapper">
            <textarea
            x-ref="draft"
            placeholder="Type here..."
            x-bind="buffer"
              @keydown.window.shift.enter="
              if($state.edit === true){
                $set('draft', $state.buffer);
                $set('edit', false)
              }
            "
            ></textarea>
            
            <small
            >Click [shift][enter] to save and enter
            <strong>VIEW</strong> mode.</small
            >
            <button x-set="edit=false;draft=buffer">Enter view</button>
            
            <div>
              <button x-undo="buffer">Undo</button>
              <button x-redo="buffer">Redo</button>
            </div>
              <h3>Edit Mode</h3>
          </div>
        </div>

        <!-- viewing -->
        <div x-show="!edit">
          <div
            class="wrapper"
            @keydown.window.escape="
              $set('edit', true);

              $nextTick(() => {
                $refs.draft.focus();
                console.log($refs.draft);
              });
              "
          >
          <div class="view">
            <p x-watch="draft"></p>
              <small>Click [escape] to enter <strong>EDIT</strong> mode.</small>
              <button x-set="edit=true">Enter edit</button>
              <div>
                <button x-undo="draft">Undo</button>
                <button x-redo="draft">Redo</button>
              </div>
              <h3>View Mode</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>

  <style>
    footer {
      margin: 0 auto;
    }
    :root {
      --primary-color: #2c3e50;
      --secondary-color: #3498db;
      --bg-color: #ecf0f1;
      --text-color: #34495e;
    }
    * {
      font-family: monospace;
    }

    h1,
    p {
      margin: 0 auto;
    }
    body {
      display: flex;
      flex-direction: column;
      background-color: var(--bg-color);
      color: var(--text-color);
    }
    textarea,
    .view p {
      min-width: 50vw;
      min-height: 30vh;
      max-width: 500px;
      margin: 1rem auto;
      padding: 2rem;
      border-radius: 10px;
      border: 2px solid var(--primary-color);
      background-color: white;
      color: var(--text-color);
      overflow-y: scroll;
      font-size: 1.5rem;
    }

  

    .wrapper {
      background-color: var(--primary-color);
      padding: 1rem;
      color: white;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      gap: 1rem;

      button,
      small {
        align-self: center;
        margin: 1rem;
      }

      button {
        padding: 1rem;
      }
    }

    .view p {
      background-color: #2c3e50;
      color: #ecf0f1;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      padding: 1rem;
      margin: 0 auto;
    }
  </style>
</html>
